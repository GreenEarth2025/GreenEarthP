<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Mopuri Canberra Family Bills Tracker</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body { font-family: Arial, sans-serif; background:#0b0f14; color:#e6edf3; margin:0; padding:20px; }
h1 { margin-top:0; }
table { width:100%; border-collapse: collapse; margin-top:10px; }
th, td { border:1px solid #444; padding:6px; text-align:left; }
th { background:#121823; }
tr:nth-child(even) { background:#1c2533; }
button { padding:6px 10px; margin:4px; cursor:pointer; }
input, select { padding:4px; }
</style>
</head>
<body>

<h1>Mopuri Canberra Family Bills Tracker</h1>
<div>
  <label>Quarter:
    <select id="quarterSelect" onchange="render()">
      <option value="ALL">All</option>
      <option value="Q1">Q1</option>
      <option value="Q2">Q2</option>
      <option value="Q3">Q3</option>
      <option value="Q4">Q4</option>
    </select>
  </label>
</div>
<button onclick="addRow()">‚ûï Add Bill</button>
<button onclick="exportData()">‚¨áÔ∏è Export JSON</button>
<button onclick="exportText()">‚¨áÔ∏è Export TXT</button>
<button onclick="exportWord()">‚¨áÔ∏è Export DOC</button>
<button onclick="importData()">‚¨ÜÔ∏è Import JSON</button>

<table id="billTable">
<thead>
<tr>
  <th>Quarter</th>
  <th>Bill</th>
  <th>Category</th>
  <th>Amount</th>
  <th>Due Date</th>
  <th>Required?</th>
  <th>Paid?</th>
  <th>Paid Date</th>
  <th>Paid By</th>
  <th>Attachment</th>
  <th>Actions</th>
</tr>
</thead>
<tbody></tbody>
</table>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js"></script>

<script>
// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyAuXpCPWPQCAuxVsunGBeQCF3-Q3Ifu4AM",
  authDomain: "mopuri-bills.firebaseapp.com",
  projectId: "mopuri-bills",
  storageBucket: "mopuri-bills.appspot.com",
  messagingSenderId: "541909464325",
  appId: "1:541909464325:web:0f86a26f17317d01b1336c"
};

// Init Firebase
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// Local cache key
const CACHE_KEY = 'mopuri-bills-cache';
let bills = [];

// Load from Firestore
async function loadFromCloud() {
  try {
    const docSnap = await db.collection('users').doc('prakash').get();
    if (docSnap.exists) {
      bills = docSnap.data().bills;
      localStorage.setItem(CACHE_KEY, JSON.stringify(bills));
    } else {
      bills = seedData();
      await saveToCloud();
    }
  } catch (e) {
    console.error("Cloud load failed, using cache", e);
    bills = JSON.parse(localStorage.getItem(CACHE_KEY) || '[]');
    if (!bills.length) bills = seedData();
  }
  render();
}

// Save to Firestore
async function saveToCloud() {
  try {
    await db.collection('users').doc('prakash').set({ bills });
    localStorage.setItem(CACHE_KEY, JSON.stringify(bills));
  } catch (e) {
    console.error("Cloud save failed", e);
  }
}

// Dummy data
function seedData() {
  return [
    {q:'Q1', name:'Rent', cat:'Housing', amt:2300, due:'2025-07-01', req:true, paid:true, paidDate:'2025-07-01', paidBy:'Prakash', attach:''},
    {q:'Q1', name:'Electricity', cat:'Utilities', amt:210.5, due:'2025-07-25', req:true, paid:false, paidDate:'', paidBy:'', attach:''},
    {q:'Q1', name:'Water', cat:'Utilities', amt:95.3, due:'2025-08-05', req:true, paid:false, paidDate:'', paidBy:'', attach:''},
    {q:'Q2', name:'Gas', cat:'Utilities', amt:140, due:'2025-10-18', req:true, paid:true, paidDate:'2025-10-18', paidBy:'Partner', attach:''},
    {q:'Q2', name:'Council Rates', cat:'Housing', amt:550, due:'2025-11-15', req:true, paid:false, paidDate:'', paidBy:'', attach:''},
    {q:'Q3', name:'Car Insurance', cat:'Insurance', amt:780, due:'2026-02-14', req:true, paid:false, paidDate:'', paidBy:'', attach:''},
    {q:'Q3', name:'Childcare Fees', cat:'Family', amt:420, due:'2026-02-07', req:true, paid:false, paidDate:'', paidBy:'', attach:''},
    {q:'Q4', name:'Strata', cat:'Housing', amt:760, due:'2026-05-20', req:true, paid:false, paidDate:'', paidBy:'', attach:''},
    {q:'Q4', name:'Health Insurance', cat:'Insurance', amt:265, due:'2026-06-02', req:true, paid:true, paidDate:'2026-06-02', paidBy:'Prakash', attach:''},
    {q:'Q4', name:'Amazon Prime', cat:'Subscriptions', amt:9.99, due:'2026-06-15', req:false, paid:false, paidDate:'', paidBy:'', attach:''}
  ];
}

// Render table
function render(){
  const qFilter = document.getElementById('quarterSelect').value;
  const tbody = document.querySelector('#billTable tbody');
  tbody.innerHTML = '';
  bills.forEach((b,i)=>{
    if(qFilter!=='ALL' && b.q!==qFilter) return;
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td contenteditable oninput="update(${i},'q',this.innerText)">${b.q}</td>
      <td contenteditable oninput="update(${i},'name',this.innerText)">${b.name}</td>
      <td contenteditable oninput="update(${i},'cat',this.innerText)">${b.cat}</td>
      <td contenteditable oninput="update(${i},'amt',parseFloat(this.innerText)||0)">${b.amt}</td>
      <td><input type="date" value="${b.due}" onchange="update(${i},'due',this.value)"></td>
      <td><input type="checkbox" ${b.req?'checked':''} onchange="update(${i},'req',this.checked)"></td>
      <td><input type="checkbox" ${b.paid?'checked':''} onchange="update(${i},'paid',this.checked)"></td>
      <td><input type="date" value="${b.paidDate||''}" onchange="update(${i},'paidDate',this.value)"></td>
      <td contenteditable oninput="update(${i},'paidBy',this.innerText)">${b.paidBy||''}</td>
      <td><input type="file" accept='.txt,.pdf,.doc,.docx' onchange="attachFile(${i},this.files[0])"></td>
      <td><button onclick="delRow(${i})">üóëÔ∏è</button></td>
    `;
    tbody.appendChild(tr);
  });
}

// Update field
function update(i,field,value){
  bills[i][field]=value;
  saveToCloud();
}

// Add row
function addRow(){
  bills.push({q:'Q1', name:'New Bill', cat:'Other', amt:0, due:new Date().toISOString().slice(0,10), req:false, paid:false, paidDate:'', paidBy:'', attach:''});
  saveToCloud(); render();
}

// Delete row
function delRow
