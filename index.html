<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Canberra MOPURIFamily Bill Tracker</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body { font-family: Arial, sans-serif; background:#0b0f14; color:#e6edf3; margin:0; padding:20px; }
h1 { margin-top:0; }
table { width:100%; border-collapse: collapse; margin-top:10px; }
th, td { border:1px solid #444; padding:6px; text-align:left; }
th { background:#121823; }
tr:nth-child(even) { background:#1c2533; }
button { padding:6px 10px; margin:4px; cursor:pointer; }
input, select { padding:4px; }
canvas { background:#121823; margin-top:20px; padding:10px; border-radius:8px; }
</style>
</head>
<body>

<h1>Canberra Family Bill Tracker</h1>
<div>
  <label>Quarter:
    <select id="quarterSelect" onchange="render();drawChart();">
      <option value="ALL">All</option>
      <option value="Q1">Q1</option>
      <option value="Q2">Q2</option>
      <option value="Q3">Q3</option>
      <option value="Q4">Q4</option>
    </select>
  </label>
</div>
<button onclick="addRow()">‚ûï Add Bill</button>
<button onclick="exportData()">‚¨áÔ∏è Export JSON</button>
<button onclick="exportText()">‚¨áÔ∏è Export TXT</button>
<button onclick="exportWord()">‚¨áÔ∏è Export DOC</button>
<button onclick="importData()">‚¨ÜÔ∏è Import JSON</button>

<table id="billTable">
<thead>
<tr>
  <th>Quarter</th>
  <th>Bill</th>
  <th>Category</th>
  <th>Amount</th>
  <th>Due Date</th>
  <th>Required?</th>
  <th>Paid?</th>
  <th>Paid Date</th>
  <th>Paid By</th>
  <th>Attachment</th>
  <th>Actions</th>
</tr>
</thead>
<tbody></tbody>
</table>

<canvas id="paidChart" width="400" height="200"></canvas>

<script>
const STORAGE_KEY = 'bills-v5';
let bills = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');

if (!bills.length) {
  bills = [
    {q:'Q1', name:'Rent', cat:'Housing', amt:2300, due:'2025-07-01', req:true, paid:true, paidDate:'2025-07-01', paidBy:'Prakash', attach:''},
    {q:'Q1', name:'Electricity', cat:'Utilities', amt:210.5, due:'2025-07-25', req:true, paid:false, paidDate:'', paidBy:'', attach:''},
    {q:'Q2', name:'Gas', cat:'Utilities', amt:140, due:'2025-10-18', req:true, paid:true, paidDate:'2025-10-18', paidBy:'Partner', attach:''},
    {q:'Q3', name:'Water', cat:'Utilities', amt:95.3, due:'2026-02-05', req:true, paid:false, paidDate:'', paidBy:'', attach:''},
    {q:'Q4', name:'Internet', cat:'Connectivity', amt:79, due:'2026-05-10', req:true, paid:false, paidDate:'', paidBy:'', attach:''}
  ];
  save();
}

function save(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(bills)); }

function render(){
  const qFilter = document.getElementById('quarterSelect').value;
  const tbody = document.querySelector('#billTable tbody');
  tbody.innerHTML = '';
  bills.forEach((b,i)=>{
    if(qFilter!=='ALL' && b.q!==qFilter) return;
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td contenteditable oninput="update(${i},'q',this.innerText)">${b.q}</td>
      <td contenteditable oninput="update(${i},'name',this.innerText)">${b.name}</td>
      <td contenteditable oninput="update(${i},'cat',this.innerText)">${b.cat}</td>
      <td contenteditable oninput="update(${i},'amt',parseFloat(this.innerText)||0)">${b.amt}</td>
      <td><input type="date" value="${b.due}" onchange="update(${i},'due',this.value)"></td>
      <td><input type="checkbox" ${b.req?'checked':''} onchange="update(${i},'req',this.checked)"></td>
      <td><input type="checkbox" ${b.paid?'checked':''} onchange="update(${i},'paid',this.checked); if(this.checked&&!bills[${i}].paidDate)bills[${i}].paidDate=new Date().toISOString().slice(0,10); save(); render(); drawChart();"></td>
      <td><input type="date" value="${b.paidDate||''}" onchange="update(${i},'paidDate',this.value)"></td>
      <td contenteditable oninput="update(${i},'paidBy',this.innerText)">${b.paidBy||''}</td>
      <td><input type="file" accept='.txt,.pdf,.doc,.docx' onchange="attachFile(${i},this.files[0])"></td>
      <td><button onclick="delRow(${i})">üóëÔ∏è</button></td>
    `;
    tbody.appendChild(tr);
  });
}

function update(i,field,value){ bills[i][field]=value; save(); }
function addRow(){
  bills.push({q:'Q1', name:'New Bill', cat:'Other', amt:0, due:new Date().toISOString().slice(0,10), req:false, paid:false, paidDate:'', paidBy:'', attach:''});
  save(); render(); drawChart();
}
function delRow(i){ if(confirm('Delete this bill?')){ bills.splice(i,1); save(); render(); drawChart(); } }
function attachFile(i,file){ if(file){ bills[i].attach=file.name; save(); alert('Attached: '+file.name); } }

function exportData(){
  const blob=new Blob([JSON.stringify(bills,null,2)],{type:'application/json'});
  const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='bills.json'; a.click();
}
function exportText(){
  let text='Quarter\tBill\tCategory\tAmount\tDue Date\tRequired\tPaid\tPaid Date\tPaid By\tAttachment\n';
  bills.forEach(b=>{ text+=`${b.q}\t${b.name}\t${b.cat}\t${b.amt}\t${b.due}\t${b.req}\t${b.paid}\t${b.paidDate}\t${b.paidBy}\t${b.attach}\n`; });
  const blob=new Blob([text],{type:'text/plain'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='bills.txt'; a.click();
}
function exportWord(){
  let html='<html><body><table border="1"><tr><th>Quarter</th><th>Bill</th><th>Category</th><th>Amount</th><th>Due Date</th><th>Required</th><th>Paid</th><th>Paid Date</th><th>Paid By</th><th>Attachment</th></tr>';
  bills.forEach(b=>{ html+=`<tr><td>${b.q}</td><td>${b.name}</td><td>${b.cat}</td><td>${b.amt}</td><td>${b.due}</td><td>${b.req}</td><td>${b.paid}</td><td>${b.paidDate}</td><td>${b.paidBy}</td><td>${b.attach}</td></tr>`; });
  html+='</table></body></html>';
  const blob=new Blob([html],{type:'application/msword'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='bills.doc'; a.click();
}
function importData(){
  const json=prompt('Paste JSON here:');
